<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="android,dex,hidex," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.0.2" />






<meta name="description" content="ç°åœ¨éƒ¨åˆ† app å‡ºäºå®‰å…¨æ€§(æ¯”å¦‚åŠ å¯†ç®—æ³•)æˆ–è€…ç”¨æˆ·ä½“éªŒ(çƒ­è¡¥ä¸ä¿®å¤bug)ä¼šè€ƒè™‘å°†éƒ¨åˆ†æ¨¡å—é‡‡ç”¨çƒ­åŠ è½½çš„å½¢å¼ Loadã€‚æ‰€ä»¥é’ˆå¯¹è¿™éƒ¨åˆ†çš„ dex è¿›è¡ŒåŠ å¯†æ˜¯æœ‰å¿…è¦çš„ï¼Œå¦‚æœ dex æ˜¯ä¿®å¤çš„åŠ å¯†ç®—æ³•ï¼Œä½ æ€»ä¸æƒ³è¢«äººä¸€ä¸‹å°±åç¼–è¯‘å‡ºæ¥å§ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªåŠ å¯†ç®—æ³•å¯¹ dex è¿›è¡ŒåŠ å¯†ï¼ŒLoad å‰è¿›è¡Œè§£å¯†å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æœ€å¥½çš„åŠ å¯†å°±æ˜¯è®©äººåˆ†ä¸æ¸…ä½ æ˜¯å¦åŠ å¯†äº†ã€‚ä¸€èˆ¬é€†å‘è¿‡ç¨‹ä¸­æ‹¿åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥åç¼–è¯‘æˆ java">
<meta property="og:type" content="article">
<meta property="og:title" content="DEXæ–‡ä»¶æ··æ·†åŠ å¯†">
<meta property="og:url" content="http://gnaixx.github.io/2017/02/06/20170206hidex-hack/index.html">
<meta property="og:site_name" content="å‡¸ä¸€_ä¸€å‡¸">
<meta property="og:description" content="ç°åœ¨éƒ¨åˆ† app å‡ºäºå®‰å…¨æ€§(æ¯”å¦‚åŠ å¯†ç®—æ³•)æˆ–è€…ç”¨æˆ·ä½“éªŒ(çƒ­è¡¥ä¸ä¿®å¤bug)ä¼šè€ƒè™‘å°†éƒ¨åˆ†æ¨¡å—é‡‡ç”¨çƒ­åŠ è½½çš„å½¢å¼ Loadã€‚æ‰€ä»¥é’ˆå¯¹è¿™éƒ¨åˆ†çš„ dex è¿›è¡ŒåŠ å¯†æ˜¯æœ‰å¿…è¦çš„ï¼Œå¦‚æœ dex æ˜¯ä¿®å¤çš„åŠ å¯†ç®—æ³•ï¼Œä½ æ€»ä¸æƒ³è¢«äººä¸€ä¸‹å°±åç¼–è¯‘å‡ºæ¥å§ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªåŠ å¯†ç®—æ³•å¯¹ dex è¿›è¡ŒåŠ å¯†ï¼ŒLoad å‰è¿›è¡Œè§£å¯†å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æœ€å¥½çš„åŠ å¯†å°±æ˜¯è®©äººåˆ†ä¸æ¸…ä½ æ˜¯å¦åŠ å¯†äº†ã€‚ä¸€èˆ¬é€†å‘è¿‡ç¨‹ä¸­æ‹¿åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥åç¼–è¯‘æˆ java">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/compare-total.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/field_ids.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/compare-static.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/virtual_methods.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/compare-mutil-methods.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/compare-hide-methods.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/compare-class.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/leb128.png">
<meta property="og:image" content="http://gnaixx.github.io/blog_images/20170206/hp.png">
<meta property="og:updated_time" content="2017-02-12T14:20:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DEXæ–‡ä»¶æ··æ·†åŠ å¯†">
<meta name="twitter:description" content="ç°åœ¨éƒ¨åˆ† app å‡ºäºå®‰å…¨æ€§(æ¯”å¦‚åŠ å¯†ç®—æ³•)æˆ–è€…ç”¨æˆ·ä½“éªŒ(çƒ­è¡¥ä¸ä¿®å¤bug)ä¼šè€ƒè™‘å°†éƒ¨åˆ†æ¨¡å—é‡‡ç”¨çƒ­åŠ è½½çš„å½¢å¼ Loadã€‚æ‰€ä»¥é’ˆå¯¹è¿™éƒ¨åˆ†çš„ dex è¿›è¡ŒåŠ å¯†æ˜¯æœ‰å¿…è¦çš„ï¼Œå¦‚æœ dex æ˜¯ä¿®å¤çš„åŠ å¯†ç®—æ³•ï¼Œä½ æ€»ä¸æƒ³è¢«äººä¸€ä¸‹å°±åç¼–è¯‘å‡ºæ¥å§ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªåŠ å¯†ç®—æ³•å¯¹ dex è¿›è¡ŒåŠ å¯†ï¼ŒLoad å‰è¿›è¡Œè§£å¯†å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æœ€å¥½çš„åŠ å¯†å°±æ˜¯è®©äººåˆ†ä¸æ¸…ä½ æ˜¯å¦åŠ å¯†äº†ã€‚ä¸€èˆ¬é€†å‘è¿‡ç¨‹ä¸­æ‹¿åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥åç¼–è¯‘æˆ java">
<meta name="twitter:image" content="http://gnaixx.github.io/blog_images/20170206/compare-total.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="http://gnaixx.github.io/2017/02/06/20170206hidex-hack/"/>


  <title> DEXæ–‡ä»¶æ··æ·†åŠ å¯† | å‡¸ä¸€_ä¸€å‡¸ </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?bb104a561bbdd3b6666195d45e5581a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">å‡¸ä¸€_ä¸€å‡¸</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">gnaixx</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                DEXæ–‡ä»¶æ··æ·†åŠ å¯†
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-02-06T23:24:44+08:00" content="2017-02-06">
              2017-02-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/06/20170206hidex-hack/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/06/20170206hidex-hack/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>æ··æ·†åŠ å¯†ä¸»è¦æ˜¯ä¸ºäº†éšè— dex æ–‡ä»¶ä¸­å…³é”®çš„ä»£ç ï¼ŒåŠ›åº¦ä»è½»åˆ°é‡åŒ…æ‹¬ï¼šé™æ€å˜é‡çš„éšè—ã€å‡½æ•°çš„é‡å¤å®šä¹‰ã€å‡½æ•°çš„éšè—ã€ä»¥åŠæ•´ä¸ªç±»çš„éšè—ã€‚æ··æ·†åçš„ dex æ–‡ä»¶ä¾æ—§å¯ä»¥é€šè¿‡ dex2jar jade ç­‰å·¥å…·çš„åç¼–è¯‘æˆ Java æºç ï¼Œä½†æ˜¯é‡Œé¢å…³é”®çš„ä»£ç å·²ç»çœ‹ä¸åˆ°äº†ã€‚<br><strong>æ•ˆæœå›¾ï¼š</strong><br><img src="/blog_images/20170206/compare-total.png" alt="æ•ˆæœå›¾"></p>
<p>æºç åœ°å€å’Œä½¿ç”¨è¯´æ˜åœ¨ github ä¸Š <strong><a href="https://github.com/gnaixx/hidex-hack" target="_blank" rel="external">hidex-hack</a></strong></p>
<h2 id="0x01-dexæ ¼å¼åˆ†æ"><a href="#0x01-dexæ ¼å¼åˆ†æ" class="headerlink" title="0x01 dexæ ¼å¼åˆ†æ"></a>0x01 dexæ ¼å¼åˆ†æ</h2><p>dex æ–‡ä»¶æ ¼å¼åœ¨ä¸Šä¸€ç¯‡æœ‰è¿›è¡Œäº†æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œå…·ä½“å¯çœ‹<strong><a href="http://gnaixx.cc/2016/11/26/20161126dex-file/" target="_blank" rel="external">dexæ–‡ä»¶æ ¼å¼åˆ†æ</a></strong>ï¼Œè¿™é‡Œç®€å•çš„ä»‹ç»ä¸€ä¸‹æ•´ä¸ª dex æ–‡ä»¶çš„å¸ƒå±€ã€‚  </p>
<p><strong>1.header(dexå¤´éƒ¨)</strong><br>header æ¦‚è¿°äº†æ•´ä¸ª dex æ–‡ä»¶çš„åˆ†å¸ƒæƒ…å†µï¼ŒåŒ…æ‹¬äº†ï¼š<strong>magic</strong>, <strong>checksum</strong>, <strong>signature</strong>, <strong>file_size</strong>, <strong>header_size</strong>, <strong>endian_tag</strong>, <strong>link</strong>, <strong>map</strong>, <strong>string_ids</strong>, <strong>type_ids</strong>, <strong>proto_ids</strong>, <strong>field_ids</strong>, <strong>method_ids</strong>, <strong>class_defs</strong>, <strong>data</strong>ã€‚</p>
<ul>
<li><strong>checksum</strong> å’Œ <strong>signature</strong> æ˜¯æ ¡éªŒå€¼ï¼Œä¿®æ”¹åéœ€è¦å¯¹å…¶è¿›è¡Œä¿®å¤</li>
<li><strong>string_ids</strong>, <strong>type_ids</strong>, <strong>proto_ids</strong>, <strong>field_ids</strong>, <strong>method_ids</strong> ä½œä¸ºç±»å‹æ•°ç»„èŠ‚åŒºï¼ˆæˆ‘çèµ·çš„ï¼‰ä¿å­˜äº†ä¸åŒç±»å‹çš„å€¼</li>
<li><strong>class_defs</strong> å­˜å‚¨äº†ç±»çš„å®šä¹‰ä¹Ÿæ˜¯æˆ‘ä»¬ä¿®æ”¹çš„é‡ç‚¹</li>
<li><strong>data</strong> æ˜¯æ•°æ®å­˜å‚¨åŒºï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„æ•°æ®</li>
</ul>
<p><strong>2.ç±»å‹æ•°ç»„èŠ‚åŒº</strong><br>ç±»å‹æ•°ç»„èŠ‚åŒºåŒ…æ‹¬äº†<strong>string_ids</strong>, <strong>type_ids</strong>, <strong>proto_ids</strong>, <strong>field_ids</strong>, <strong>method_ids</strong>ã€‚åˆ†åˆ«è¡¨ç¤ºï¼šå­—ç¬¦ä¸²ï¼Œç±»å‹ï¼Œå‡½æ•°ç­¾åï¼Œå±æ€§ï¼Œå‡½æ•°ã€‚æ¯ä¸ªèŠ‚åŒºéƒ½ä¿å­˜äº†å¯¹åº”ç±»å‹æ•°æ®æ•°ç»„ï¼Œå¯ä»¥ç”¨ 010Editor åˆ†æäºŒè¿›åˆ¶æ–‡ä»¶æ•°æ®ã€‚<br><strong>å±æ€§ç¤ºä¾‹ï¼š</strong><br><img src="/blog_images/20170206/field_ids.png" alt="field_ids"></p>
<p><strong>3.ç±»å®šä¹‰</strong><br>ç±»å®šä¹‰æ˜¯ä¿®æ”¹çš„é‡ç‚¹ï¼Œè¿™é‡Œä¿å­˜äº†æ‰€æœ‰ç±»çš„ç»“æ„ï¼Œä¹Ÿæ˜¯æ•´ä¸ª dex æ–‡ä»¶ä¸­ç»“æ„æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚å…¶ä¸­åŒ…æ‹¬äº†ï¼šé™æ€å±æ€§å˜é‡ã€æˆå‘˜æ•°å½¢å˜é‡ï¼Œè™šå‡½æ•°ï¼Œç›´æ¥å‡½æ•°ï¼Œé™æ€å‡½æ•°ç­‰æ•°æ®ã€‚</p>
<h2 id="0x02-å®ç°åŠŸèƒ½"><a href="#0x02-å®ç°åŠŸèƒ½" class="headerlink" title="0x02 å®ç°åŠŸèƒ½"></a>0x02 å®ç°åŠŸèƒ½</h2><p>é€šè¿‡åˆ†æ dex æ–‡ä»¶æ ¼å¼ï¼Œç°åœ¨å¯ä»¥å®ç°çš„æ··æ·†åŠ å¯†ä¸»è¦åŒ…æ‹¬å››ç§ï¼š</p>
<ol>
<li>é™æ€å˜é‡éšè—</li>
<li>å‡½æ•°é‡å¤å®šä¹‰</li>
<li>å‡½æ•°éšè—</li>
<li>ç±»å®šä¹‰éšè—</li>
</ol>
<p>å››ç§æ··æ·†åŠ å¯†çš„å®ç°æ–¹å¼éƒ½æ˜¯é€šè¿‡ä¿®æ”¹ <strong>class_def</strong> ç»“æ„ä½“ä¸­å­—æ®µå®ç°çš„ã€‚å¯ä»¥é€šè¿‡ json æ ¼å¼äº†è§£ä¸€ä¸‹ <strong>class_def</strong> çš„ç»“æ„ï¼ˆè¿™é‡Œåªåˆ—å‡ºæ¥è¦ç”¨åˆ°çš„å­—æ®µï¼‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"class_def"</span>: &#123;</div><div class="line">  	<span class="string">"class_idx"</span>: <span class="number">01</span></div><div class="line">  	<span class="string">"static_values_off"</span>: <span class="number">000</span>,       </div><div class="line">  	<span class="string">"class_data_off"</span>: <span class="number">001</span>,          </div><div class="line">  	<span class="string">"class_data"</span>: &#123;                 </div><div class="line">  		<span class="string">"direct_methods_size"</span>: <span class="number">001</span>,  </div><div class="line">  		<span class="string">"virtual_methods_size"</span>: <span class="number">002</span>, </div><div class="line">  		<span class="string">"virtual_methods"</span>:[          </div><div class="line">  			&#123;</div><div class="line">  				<span class="string">"code_off"</span>: <span class="number">003</span> </div><div class="line">  			&#125;,</div><div class="line">  			&#123;</div><div class="line">  				<span class="string">"code_off"</span>: <span class="number">004</span></div><div class="line">  			&#125;</div><div class="line">  		]</div><div class="line">  	&#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å­—æ®µå«ä¹‰ï¼š</p>
<ul>
<li>class_idx: ç±»ååºå·ï¼Œå€¼æ˜¯type_idsçš„ä¸€ä¸ªindex</li>
<li>class_def: ç±»å®šä¹‰ç»“æ„ä½“</li>
<li>static_values_off: é™æ€å˜é‡å€¼åç§»</li>
<li>class_data_off: ç±»å®šä¹‰åç§»</li>
<li>class_data: ç±»å®šä¹‰ç»“æ„ä½“</li>
<li>direct_methods_size: ç›´æ¥å‡½æ•°ä¸ªæ•°</li>
<li>virtual_methods_size: è™šå‡½æ•°ä¸ªæ•°</li>
<li>virtual_methods: è™šå‡½æ•°ç»“æ„ä½“</li>
<li>code_off: å‡½æ•°ä»£ç åç§»</li>
</ul>
<p>é€šè¿‡ä¸Šé¢çš„å­—æ®µä»‹ç»å…¶å®å¾ˆå®¹æ˜“å¾—åˆ°å››ä¸ªåŠŸèƒ½çš„å®ç°æ–¹æ¡ˆï¼Œä¸‹é¢ä¸€ä¸ªä¸€ä¸ªä»‹ç»ã€‚</p>
<h3 id="1-é™æ€å˜é‡éšè—"><a href="#1-é™æ€å˜é‡éšè—" class="headerlink" title="1.é™æ€å˜é‡éšè—"></a>1.é™æ€å˜é‡éšè—</h3><p><strong>static_vaules_off</strong> ä¿å­˜äº†æ¯ä¸ªç±»ä¸­é™æ€å˜é‡çš„å€¼çš„åç§»é‡ï¼ŒæŒ‡å‘ data åŒºé‡Œçš„ä¸€ä¸ªåˆ—è¡¨ï¼Œæ ¼å¼ä¸º <strong>encode_array_item</strong>ï¼Œå¦‚æœæ²¡æœ‰æ­¤é¡¹å†…å®¹ï¼Œè¯¥å€¼ä¸º0ã€‚æ‰€ä»¥è¦å®ç°é™æ€å˜é‡èµ‹å€¼éšè—åªéœ€è¦å°† <strong>static_values_off</strong> å€¼ä¿®æ”¹ä¸º0ã€‚<br><strong>å®ç°æ•ˆæœï¼š</strong><br><img src="/blog_images/20170206/compare-static.png" alt="é™æ€å˜é‡éšè—"></p>
<p><em>è¿™é‡Œçš„é™æ€æ•°ç»„æ•°æ®æ²¡æœ‰æˆåŠŸéšè—ï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæã€‚ğŸ˜¶</em></p>
<h3 id="2-å‡½æ•°é‡å¤å®šä¹‰"><a href="#2-å‡½æ•°é‡å¤å®šä¹‰" class="headerlink" title="2.å‡½æ•°é‡å¤å®šä¹‰"></a>2.å‡½æ•°é‡å¤å®šä¹‰</h3><p><strong>class_def -&gt; class_data -&gt; virtual_methods -&gt; code_ff</strong> è¡¨ç¤ºçš„æ˜¯æŸä¸ªç±»ä¸­æŸä¸ªå‡½æ•°çš„ä»£ç åç§»åœ°å€ã€‚è¿™é‡Œéœ€è¦æåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šJava ä¸­æ‰€æœ‰å‡½æ•°å®ç°éƒ½æ˜¯è™šå‡½æ•°ï¼Œè¿™ä¸€ç‚¹å’Œ C++ æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€æœ‰è¿™é‡Œä¿®æ”¹çš„éƒ½æ˜¯ <strong>virtual_methods</strong> ä¸­ <strong>code_off</strong>ã€‚</p>
<p><img src="/blog_images/20170206/virtual_methods.png" alt="virtual_methods"></p>
<p>å®ç°æ–¹å¼:è¯»å–ç¬¬ä¸€ä¸ªå‡½æ•°çš„ä»£ç åç§»åœ°å€ï¼Œå°†æ¥ä¸‹æ¥çš„å‡½æ•°åç§»åœ°å€éƒ½ä¿®æ”¹ä¸ºç¬¬ä¸€çš„å€¼ã€‚</p>
<p><strong>å®ç°æ•ˆæœ:</strong><br><img src="/blog_images/20170206/compare-mutil-methods.png" alt="mutil-methods"></p>
<h3 id="3-å‡½æ•°éšè—"><a href="#3-å‡½æ•°éšè—" class="headerlink" title="3.å‡½æ•°éšè—"></a>3.å‡½æ•°éšè—</h3><p><strong>class_def -&gt; class_data -&gt; virtual_methods_size</strong> å’Œ <strong>class_def -&gt; class_data -&gt; direct_methods_size</strong> è®°å½•äº†ç±»å®šä¹‰ä¸­å‡½æ•°çš„ä¸ªæ•°,å¦‚æœæ²¡æœ‰å®šä¹‰å‡½æ•°åˆ™è¯¥å€¼ä¸º0ã€‚æ‰€ä»¥åªè¦å°†è¯¥å€¼æ”¹ä¸º0ï¼Œå‡½æ•°å®šä¹‰å°±ä¼šè¢«éšè—ã€‚</p>
<p><strong>å®ç°æ•ˆæœ:</strong><br><img src="/blog_images/20170206/compare-hide-methods.png" alt="hide-methods"></p>
<h3 id="4-ç±»å®šä¹‰éšè—"><a href="#4-ç±»å®šä¹‰éšè—" class="headerlink" title="4.ç±»å®šä¹‰éšè—"></a>4.ç±»å®šä¹‰éšè—</h3><p><strong>class_def -&gt; class_data_off</strong> ä¿å­˜äº†å…·ä½“ç±»å®šä¹‰çš„åç§»åœ°å€ï¼Œä¹Ÿå°±æ˜¯ <strong>class_def -&gt; class_data</strong> çš„åœ°å€ï¼Œå¦‚æœè¯¥å€¼ä¸º0åˆ™æ‰€æœ‰å®ç°å°†è¢«éšè—ã€‚éšè—åä¼šæŠŠç±»å®šä¹‰çš„æ‰€æœ‰ä¸œè¥¿éƒ½éšè—åŒ…æ‹¬æˆå‘˜å˜é‡ï¼Œæˆå‘˜å‡½æ•°ï¼Œé™æ€å˜é‡ï¼Œé™æ€å‡½æ•°ã€‚</p>
<p><strong>å®ç°æ•ˆæœ:</strong><br><img src="/blog_images/20170206/compare-class.png" alt="hide-class"></p>
<h2 id="0x03-æ•°æ®è¯»å–"><a href="#0x03-æ•°æ®è¯»å–" class="headerlink" title="0x03 æ•°æ®è¯»å–"></a>0x03 æ•°æ®è¯»å–</h2><p>ä¸Šé¢ä¸€ä¸ªç« èŠ‚ä¸»è¦ä»‹ç»äº†åŠŸèƒ½å®ç°çš„åŸç†ï¼Œæ¥ä¸‹æ¥è¦ä»‹ç»å…·ä½“å®ç°äº†ã€‚è¦å®ç°ä¿®æ”¹ <strong>class_def</strong> ä¸­å­—æ®µï¼Œé¦–å…ˆè¦æŠŠæ•´ä¸ª dex æ–‡ä»¶ç»“æ„è§£æå‡ºæ¥ï¼Œå½“ç„¶å¯ä»¥åªæ˜¯æˆ‘ä»¬éœ€è¦çš„å­—æ®µã€‚åœ¨å·¥å…·ä¸­æˆ‘å®šä¹‰çš„ dex ç»“æ„å¦‚ä¸‹ï¼Œå› ä¸º <strong>class_def</strong> ç»“æ„æ¯”è¾ƒå¤æ‚æ‰€ä»¥ç‹¬ç«‹äº†ä¸€ä¸ªåŒ…å®šä¹‰ï¼š    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">â†’ tree -L 2</div><div class="line">.</div><div class="line">â”œâ”€â”€ DexFile.java</div><div class="line">â”œâ”€â”€ FieldIds.java</div><div class="line">â”œâ”€â”€ Header.java</div><div class="line">â”œâ”€â”€ MapList.java</div><div class="line">â”œâ”€â”€ MethodIds.java</div><div class="line">â”œâ”€â”€ ProtoIds.java</div><div class="line">â”œâ”€â”€ StringIds.java</div><div class="line">â”œâ”€â”€ TypeIds.java</div><div class="line">â””â”€â”€ cladef</div><div class="line">    â”œâ”€â”€ ClassData.java</div><div class="line">    â”œâ”€â”€ ClassDefs.java</div><div class="line">    â”œâ”€â”€ Code.java</div><div class="line">    â”œâ”€â”€ EncodedField.java</div><div class="line">    â”œâ”€â”€ EncodedMethod.java</div><div class="line">    â”œâ”€â”€ EncodedValue.java</div><div class="line">    â””â”€â”€ StaticValues.java</div></pre></td></tr></table></figure>
<p>ä¹Ÿè®¸ä½ å¯èƒ½ä¼šç–‘é—®ï¼Œæˆ‘ä»¬åŠŸèƒ½å®ç°æ—¶å€™åªéœ€è¦ä¿®æ”¹ <strong>class_def</strong> ä¸ºä»€ä¹ˆè¿˜éœ€è¦è¯»å– <strong>string_ids</strong> è¿™äº›åŒºæ®µã€‚è¿™æ˜¯å› ä¸ºåƒä¸Šé¢æåˆ°çš„ <strong>class_def -&gt; class_idx</strong> ä¿å­˜çš„å…¶å®æ˜¯ <strong>type_ids</strong> ä¸­çš„åºå·ï¼Œè€Œ <strong>type_ids</strong> ä¸­ä¿å­˜çš„æ˜¯ <strong>string_ids</strong> çš„åºå·ã€‚</p>
<p>ä¸ºäº†çµæ´»é…ç½®ï¼Œè¿è¡Œå·¥å…·çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦é…ç½®å¥½è¦éšè—çš„ç±»åï¼Œæ¯”å¦‚éœ€è¦éšè—æŸä¸ªç±»çš„å®ç° <code>hack_me_size: cc.gnaixx.samp.core.EntranceImpl</code>, é…ç½®æ–‡ä»¶çš„å…·ä½“å®ç°ä¸‹ä¸ªç« èŠ‚ä»‹ç»ã€‚</p>
<p><strong>DexFile.java</strong> å®šä¹‰äº†æ•´ä¸ª dex æ–‡ä»¶ç»“æ„, å®ç°æ¯”è¾ƒç®€å•åªæœ‰ä¸€ä¸ª <strong>read(byte[] dexBuff)</strong> å‡½æ•°è¯»å–æ•´ä¸ª dex æ–‡ä»¶æ ¼å¼ã€‚</p>
<p><strong>DexFile.java:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DexFile</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HEADER_LEN = <span class="number">0x70</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> Header header;</div><div class="line">    <span class="keyword">public</span> StringIds stringIds;</div><div class="line">    <span class="keyword">public</span> TypeIds typeIds;</div><div class="line">    <span class="keyword">public</span> ProtoIds protoIds;</div><div class="line">    <span class="keyword">public</span> FieldIds fieldIds;</div><div class="line">    <span class="keyword">public</span> MethodIds methodIds;</div><div class="line">    <span class="keyword">public</span> ClassDefs classDefs;</div><div class="line">    <span class="keyword">public</span> MapList mapList;</div><div class="line"></div><div class="line">    <span class="comment">//reader dex</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] dexBuff)</span></span>&#123;</div><div class="line">        <span class="comment">//read header</span></div><div class="line">        <span class="keyword">byte</span>[] headerbs = subdex(dexBuff, <span class="number">0</span>, HEADER_LEN);</div><div class="line">        header = <span class="keyword">new</span> Header(headerbs);</div><div class="line"></div><div class="line">        <span class="comment">//read string_ids</span></div><div class="line">        stringIds = <span class="keyword">new</span> StringIds(dexBuff, header.stringIdsOff, header.stringIdsSize);</div><div class="line"></div><div class="line">        <span class="comment">//read type_ids</span></div><div class="line">        typeIds = <span class="keyword">new</span> TypeIds(dexBuff, header.typeIdsOff, header.typeIdsSize);</div><div class="line"></div><div class="line">        <span class="comment">//read proto_ids</span></div><div class="line">        protoIds = <span class="keyword">new</span> ProtoIds(dexBuff, header.protoIdsOff, header.protoIdsSize);</div><div class="line"></div><div class="line">        <span class="comment">//read field_ids</span></div><div class="line">        fieldIds = <span class="keyword">new</span> FieldIds(dexBuff, header.fieldIdsOff, header.fieldIdsSize);</div><div class="line"></div><div class="line">        <span class="comment">//read method_ids</span></div><div class="line">        methodIds = <span class="keyword">new</span> MethodIds(dexBuff, header.methodIdsOff, header.methodIdsSize);</div><div class="line"></div><div class="line">        <span class="comment">//read class_defs</span></div><div class="line">        classDefs = <span class="keyword">new</span> ClassDefs(dexBuff, header.classDefsOff, header.classDefsSize);</div><div class="line"></div><div class="line">        <span class="comment">//read map_list</span></div><div class="line">        mapList = <span class="keyword">new</span> MapList(dexBuff, header.mapOff);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ­¥è¦å…ˆè¯»å– <strong>header</strong> å› ä¸ºå®ƒä¿å­˜äº†å…¶ä»–èŠ‚åŒºçš„åç§»åœ°å€å’Œä¸ªæ•°ã€‚</p>
<p><strong>Header.java:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[]  magic           = <span class="keyword">new</span> <span class="keyword">byte</span>[MAGIC_LEN];</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     checksum;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[]  signature       = <span class="keyword">new</span> <span class="keyword">byte</span>[SIGNATURE_LEN];</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     fileSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     headerSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     endianTag;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     linkSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     linkOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     mapOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     stringIdsSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     stringIdsOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     typeIdsSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     typeIdsOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     protoIdsSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     protoIdsOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     fieldIdsSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     fieldIdsOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     methodIdsSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     methodIdsOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     classDefsSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     classDefsOff;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     dataSize;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>     dataOff;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Header</span><span class="params">(<span class="keyword">byte</span>[] headerBuff)</span> </span>&#123;</div><div class="line">        Reader reader = <span class="keyword">new</span> Reader(headerBuff, <span class="number">0</span>);</div><div class="line">        <span class="keyword">this</span>.magic = reader.subdex(MAGIC_LEN);</div><div class="line">        <span class="keyword">this</span>.checksum = reader.readUint();</div><div class="line">        <span class="keyword">this</span>.signature = reader.subdex(SIGNATURE_LEN);</div><div class="line">        <span class="comment">//......</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] dexBuff)</span></span>&#123;</div><div class="line">        Writer writer = <span class="keyword">new</span> Writer(dexBuff, <span class="number">0</span>);</div><div class="line">        writer.replace(magic, MAGIC_LEN);</div><div class="line">        writer.writeUint(checksum);</div><div class="line">        writer.replace(signature, SIGNATURE_LEN);</div><div class="line">        <span class="comment">//.....</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>çŸ¥é“äº†å„ä¸ªèŠ‚åŒºçš„åç§»åœ°å€å’Œä¸ªæ•°æ¥ä¸‹æ¥çš„è¯»å–å°±æ¯”è¾ƒç®€å•äº†ï¼Œæ¯”å¦‚ <strong>string_ids</strong> èŠ‚åŒºçš„è¯»å–ã€‚</p>
<p><strong>StringIds.java:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringIds</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">StringId</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> dataOff;            <span class="comment">//å­—ç¬¦ä¸²åç§»ä½ç½®</span></div><div class="line">        Uleb128 utf16Size;      <span class="comment">//å­—ç¬¦ä¸²é•¿åº¦</span></div><div class="line">        <span class="keyword">byte</span> data[];            <span class="comment">//å­—ç¬¦ä¸²æ•°æ®</span></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StringId</span><span class="params">(<span class="keyword">int</span> dataOff, Uleb128 uleb128, <span class="keyword">byte</span>[] data)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.dataOff = dataOff;</div><div class="line">            <span class="keyword">this</span>.utf16Size = uleb128;</div><div class="line">            <span class="keyword">this</span>.data = data;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    StringId stringIds[];</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringIds</span><span class="params">(<span class="keyword">byte</span>[] dexBuff, <span class="keyword">int</span> off, <span class="keyword">int</span> size)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.stringIds = <span class="keyword">new</span> StringId[size];</div><div class="line"></div><div class="line">        Reader reader = <span class="keyword">new</span> Reader(dexBuff, off);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">            <span class="keyword">int</span> dataOff = reader.readUint();</div><div class="line">            Uleb128 utf16Size = getUleb128(dexBuff, dataOff);</div><div class="line">            <span class="keyword">byte</span>[] data = subdex(dexBuff, dataOff + <span class="number">1</span>, utf16Size.getVal());</div><div class="line">            StringId stringId = <span class="keyword">new</span> StringId(dataOff, utf16Size, data);</div><div class="line">            stringIds[i] = stringId;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="comment">//return "(" + id + ")" + new String(stringIds[id].data);</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(stringIds[id].data);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¶ä»–èŠ‚åŒºçš„è¯»å–å’Œ <strong>string_ids</strong> ç±»ä¼¼ï¼Œä½†æ˜¯ <strong>class_def</strong> èŠ‚åŒºç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œè¯»å–èµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ã€‚ä½†æ˜¯å…¶å®æˆ‘ä»¬è¦ç”¨çš„å€¼å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œåªéœ€è¦å…³æ³¨é‚£å‡ ä¸ªå­—æ®µå°±å¥½äº†ã€‚</p>
<p><strong>ClassDefs.java:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassDefs</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassDef</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span>          classIdx;       <span class="comment">//classç±»å‹ï¼Œå¯¹åº”type_ids</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span>          accessFlags;    <span class="comment">//è®¿é—®ç±»å‹ï¼Œenum</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span>          superclassIdx;  <span class="comment">//supperclassç±»å‹ï¼Œå¯¹åº”type_ids</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span>          interfacesOff;  <span class="comment">//æ¥å£åç§»ï¼Œå¯¹åº”type_list</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span>          sourceFileIdx;  <span class="comment">//æºæ–‡ä»¶åï¼Œå¯¹åº”string_ids</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span>          annotationsOff; <span class="comment">//classæ³¨è§£ï¼Œä½ç½®ä½äºdataåŒºï¼Œå¯¹åº”annotation_direcotry_item</span></div><div class="line">        <span class="keyword">public</span> HackPoint    classDataOff;   <span class="comment">//classå…·ä½“ç”¨åˆ°çš„æ•°æ®ï¼Œä½äºdataåŒºï¼Œæ ¼å¼ä¸ºclass_data_item,æè¿°classçš„field,method,methodæ‰§è¡Œä»£ç </span></div><div class="line">        <span class="keyword">public</span> HackPoint    staticValueOff; <span class="comment">//ä½äºdataåŒºï¼Œæ ¼å¼ä¸ºencoded_array_item</span></div><div class="line"></div><div class="line">        <span class="keyword">public</span> StaticValues staticValues;  <span class="comment">// classDataOffä¸ä¸º0æ—¶å­˜åœ¨</span></div><div class="line">        <span class="keyword">public</span> ClassData    classData;     <span class="comment">// staticValueOffä¸ä¸º0å­˜åœ¨</span></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ClassDef</span><span class="params">(<span class="keyword">int</span> classIdx, <span class="keyword">int</span> accessFlags,</span></span></div><div class="line">                        <span class="keyword">int</span> superclassIdx, <span class="keyword">int</span> interfacesOff,</div><div class="line">                        <span class="keyword">int</span> sourceFileidx, <span class="keyword">int</span> annotationsOff,</div><div class="line">                        HackPoint classDataOff, HackPoint staticValueOff) &#123;</div><div class="line">            <span class="keyword">this</span>.classIdx = classIdx;</div><div class="line">            <span class="keyword">this</span>.accessFlags = accessFlags;</div><div class="line">            <span class="keyword">this</span>.superclassIdx = superclassIdx;</div><div class="line">            <span class="keyword">this</span>.interfacesOff = interfacesOff;</div><div class="line">            <span class="keyword">this</span>.sourceFileIdx = sourceFileidx;</div><div class="line">            <span class="keyword">this</span>.annotationsOff = annotationsOff;</div><div class="line">            <span class="keyword">this</span>.classDataOff = classDataOff;</div><div class="line">            <span class="keyword">this</span>.staticValueOff = staticValueOff;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClassData</span><span class="params">(ClassData classData)</span></span>&#123;</div><div class="line">            <span class="keyword">this</span>.classData = classData;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStaticValue</span><span class="params">(StaticValues staticValues)</span></span>&#123;</div><div class="line">            <span class="keyword">this</span>.staticValues = staticValues;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span>      offset; <span class="comment">//åç§»ä½ç½®</span></div><div class="line">    <span class="keyword">int</span>      size;   <span class="comment">//å¤§å°</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> ClassDef classDefs[];</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClassDefs</span><span class="params">(<span class="keyword">byte</span>[] dexBuff, <span class="keyword">int</span> off, <span class="keyword">int</span> size)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.offset = off;</div><div class="line">        <span class="keyword">this</span>.size = size;</div><div class="line"></div><div class="line">        Reader reader = <span class="keyword">new</span> Reader(dexBuff, off);</div><div class="line">        classDefs = <span class="keyword">new</span> ClassDef[size];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">            <span class="keyword">int</span> classIdx = reader.readUint();</div><div class="line">            <span class="keyword">int</span> accessFlags = reader.readUint();</div><div class="line">            <span class="keyword">int</span> superclassIdx = reader.readUint();</div><div class="line">            <span class="keyword">int</span> interfacesOff = reader.readUint();</div><div class="line">            <span class="keyword">int</span> sourcFileIdx = reader.readUint();</div><div class="line">            <span class="keyword">int</span> annotationOff = reader.readUint();</div><div class="line"></div><div class="line">            HackPoint classDataOff = <span class="keyword">new</span> HackPoint(HackPoint.UINT, reader.getOff(), reader.readUint());</div><div class="line">            HackPoint staticValueOff = <span class="keyword">new</span> HackPoint(HackPoint.UINT, reader.getOff(), reader.readUint());</div><div class="line"></div><div class="line">            ClassDef classDef = <span class="keyword">new</span> ClassDef(</div><div class="line">                    classIdx, accessFlags,</div><div class="line">                    superclassIdx, interfacesOff,</div><div class="line">                    sourcFileIdx, annotationOff,</div><div class="line">                    classDataOff, staticValueOff);</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(staticValueOff.value != <span class="number">0</span>)&#123;</div><div class="line">                Reader reader1 = <span class="keyword">new</span> Reader(dexBuff, staticValueOff.value);</div><div class="line">                Uleb128 staticSize = reader1.readUleb128();</div><div class="line">                StaticValues staticValues = <span class="keyword">new</span> StaticValues(staticSize);</div><div class="line">                classDef.setStaticValue(staticValues);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span>(classDataOff.value != <span class="number">0</span>)&#123;</div><div class="line">                classDef.setClassData(<span class="keyword">new</span> ClassData(dexBuff, classDataOff.value));</div><div class="line">            &#125;</div><div class="line">            classDefs[i] = classDef;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] dexBuff)</span></span>&#123;</div><div class="line">        Writer writer = <span class="keyword">new</span> Writer(dexBuff, offset);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;size; i++)&#123;</div><div class="line">            ClassDef classDef = classDefs[i];</div><div class="line">            writer.writeUint(classDef.classIdx);</div><div class="line">            writer.writeUint(classDef.accessFlags);</div><div class="line">            writer.writeUint(classDef.superclassIdx);</div><div class="line">            writer.writeUint(classDef.interfacesOff);</div><div class="line">            writer.writeUint(classDef.sourceFileIdx);</div><div class="line">            writer.writeUint(classDef.annotationsOff);</div><div class="line"></div><div class="line">            writer.writeUint(classDef.classDataOff.value);</div><div class="line">            <span class="keyword">if</span>(classDef.classDataOff.value != <span class="number">0</span>)&#123;</div><div class="line">                classDef.classData.write(dexBuff, classDef.classDataOff.value);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            writer.writeUint(classDef.staticValueOff.value);</div><div class="line">            <span class="keyword">if</span>(classDef.staticValueOff.value != <span class="number">0</span>)&#123;</div><div class="line">                <span class="comment">//æš‚æ—¶ä¸åšå¤„ç†</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦ä»‹ç»ä¸€ä¸‹ dex ç‰¹æœ‰çš„ä¸€ç§æ•°æ®ç±»å‹ <strong>LEB128</strong> å®˜æ–¹ä»‹ç»å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>LEB128 (â€œLittle-Endian Base 128â€) is a variable-length encoding for arbitrary signed or unsigned integer quantities. The format was borrowed from the DWARF3 specification. In a .dex file, LEB128 is only ever used to encode 32-bit quantities.</p>
<p>Each LEB128 encoded value consists of one to five bytes, which together represent a single 32-bit value. Each byte has its most significant bit set except for the final byte in the sequence, which has its most significant bit clear. The remaining seven bits of each byte are payload, with the least significant seven bits of the quantity in the first byte, the next seven in the second byte and so on. In the case of a signed LEB128 (sleb128), the most significant payload bit of the final byte in the sequence is sign-extended to produce the final value. In the unsigned case (uleb128), any bits not explicitly represented are interpreted as 0.</p>
</blockquote>
<p><img src="/blog_images/20170206/leb128.png" alt="leb128"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ LEB128 æ˜¯åŸºäº 1 ä¸ª Byte çš„ä¸€ç§ä¸å®šé•¿åº¦çš„ç¼–ç æ–¹å¼ ã€‚è‹¥ç¬¬ä¸€ä¸ª Byte çš„æœ€é«˜ä½ä¸º 1 ï¼Œåˆ™è¡¨ç¤ºè¿˜éœ€è¦ä¸‹ä¸€ä¸ª Byte æ¥æè¿° ï¼Œç›´è‡³æœ€åä¸€ä¸ª Byte çš„æœ€é«˜ ä½ä¸º 0 ã€‚æ¯ä¸ª Byte çš„å…¶ä½™ Bit ç”¨æ¥è¡¨ç¤ºæ•°æ®ã€‚</p>
<p>ä»£ç ä¸­ç”¨ ULeb128.java(unsigned æ— ç¬¦å·) è¡¨ç¤ºæ˜¯è¯¥ç»“æ„ï¼Œé€šè¿‡åˆ†æAndroidæºç  <a href="https://github.com/android/platform_dalvik/blob/master/libdex/Leb128.h" target="_blank" rel="external">Leb128.h</a>å¯ä»¥çŸ¥é“ LEB128 è™½ç„¶è¡¨ç¤ºçš„æ˜¯ä¸å®šé•¿æ ¼å¼ï¼Œä½†æ˜¯åœ¨ Android ä¸­åªç”¨åˆ°äº†4 ä¸ªbyteï¼Œæ‰€ä»¥åªéœ€è¦ç”¨intè¡¨ç¤ºå°±å¯ä»¥äº†ã€‚</p>
<p><strong>ULeb128.javaï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Uleb128</span> </span>&#123;</div><div class="line">    <span class="keyword">byte</span>[] realVal; <span class="comment">//å­˜å‚¨çš„byteæ•°æ®</span></div><div class="line">    <span class="keyword">int</span> val; <span class="comment">//è¡¨ç¤ºçš„æ•´å‹æ•°æ®</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Uleb128</span><span class="params">(<span class="keyword">byte</span>[] realVal, <span class="keyword">int</span> val)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.realVal = realVal;</div><div class="line">        <span class="keyword">this</span>.val = val;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.realVal.length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVal</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.val;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] getRealVal()&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.realVal;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Bytes to ULEB128:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Reader.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> Uleb128 <span class="title">readUleb128</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">        <span class="keyword">byte</span> realVal[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</div><div class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">do</span> &#123;</div><div class="line">            flag = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">byte</span> seg = buffer[offset];</div><div class="line">            <span class="keyword">if</span> ((seg &amp; <span class="number">0x80</span>) == <span class="number">0x80</span>) &#123; <span class="comment">//é«˜8ä½ä¸º1</span></div><div class="line">                flag = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">            seg = (<span class="keyword">byte</span>) (seg &amp; <span class="number">0x7F</span>);</div><div class="line">            value += seg &lt;&lt; (<span class="number">7</span> * count);</div><div class="line">            realVal[count] = buffer[offset];</div><div class="line">            count++;</div><div class="line">            offset++;</div><div class="line">        &#125; <span class="keyword">while</span> (flag);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Uleb128(BufferUtil.subdex(realVal, <span class="number">0</span>, count), value);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>Integer to ULEB128:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Trans.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Uleb128 <span class="title">intToUleb128</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        <span class="keyword">byte</span>[] realVal = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;; <span class="comment">//int æœ€å¤§é•¿åº¦ä¸º4</span></div><div class="line">        <span class="keyword">int</span> bk = val;</div><div class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; realVal.length; i++) &#123;</div><div class="line">            len = i + <span class="number">1</span>; <span class="comment">//æœ€å°‘é•¿åº¦ä¸º1</span></div><div class="line">            realVal[i] = (<span class="keyword">byte</span>) (val &amp; <span class="number">0x7F</span>); <span class="comment">//è·å–ä½7ä½çš„å€¼</span></div><div class="line">            <span class="keyword">if</span> (val &gt; (<span class="number">0x7F</span>)) &#123;</div><div class="line">                realVal[i] |= <span class="number">0x80</span>; <span class="comment">//é«˜ä½ä¸º1 åŠ ä¸Šå»</span></div><div class="line">            &#125;</div><div class="line">            val = val &gt;&gt; <span class="number">7</span>;</div><div class="line">            <span class="keyword">if</span> (val &lt;= <span class="number">0</span>) <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        Uleb128 uleb128 = <span class="keyword">new</span> Uleb128(BufferUtil.subdex(realVal, <span class="number">0</span>, len), bk);</div><div class="line">        <span class="keyword">return</span> uleb128;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="0x04-HackPointæ ¼å¼"><a href="#0x04-HackPointæ ¼å¼" class="headerlink" title="0x04 HackPointæ ¼å¼"></a>0x04 HackPointæ ¼å¼</h2><p><strong>HackPoint</strong> è¡¨ç¤ºä¿®æ”¹åçš„æ•°æ®ç»“æ„,ä»£ç ä¸­æŠŠæ‰€æœ‰è¦ä¿®æ”¹çš„çš„å­—æ®µéƒ½ç”¨ <strong>HackPoint</strong> ç±»å‹è¡¨ç¤ºã€‚<strong>HackPoint</strong> ç±»å‹æœ‰ä¸‰ä¸ªå­—æ®µ typeã€offsetã€valueï¼Œéƒ½æ˜¯ int ç±»å‹åˆ†åˆ«è¡¨ç¤ºï¼šç±»å‹ã€åç§»åœ°å€ã€åŸå§‹å€¼ã€‚ç±»å‹ä¸»è¦æœ‰ä¸‰ç§ <strong>uint(unsigned int)ã€ushort(unsigned short 2byte)ã€uleb128</strong>ã€‚è¿™ä¸‰ç§æ•°æ®ç”¨ int å­˜å‚¨éƒ½è¶³å¤Ÿäº†ã€‚<br><strong>HackPoint.java:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HackPoint</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UINT = <span class="number">0x01</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> USHORT = <span class="number">0x02</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ULEB128 = <span class="number">0x03</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> type;        <span class="comment">//æ•°æ®ç±»å‹</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> offset;      <span class="comment">//åç§»åœ°å€</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> value;       <span class="comment">//åŸå§‹å€¼</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HackPoint</span><span class="params">(<span class="keyword">int</span> type, <span class="keyword">int</span> offset, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">        <span class="keyword">this</span>.offset = offset;</div><div class="line">        <span class="keyword">this</span>.value = val;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> HackPoint <span class="title">clone</span><span class="params">()</span> </span>&#123;</div><div class="line">        HackPoint hp = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            hp = (HackPoint) <span class="keyword">super</span>.clone();</div><div class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> hp;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨ä¿®æ”¹å®Œåä¼šæŠŠæ‰€æœ‰çš„ <strong>HackPoint</strong> æ•°æ®å†™åœ¨ dex æ–‡ä»¶çš„æœ«å°¾ã€‚æœ¬æ¥ dex æ–‡ä»¶æœ«å°¾æ˜¯ <strong>map_list</strong> åŒºæ®µï¼Œæ•°æ®æ ¼å¼æ˜¯ :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> map_list&#123;</div><div class="line">	ushort type;</div><div class="line">	ushort unused;</div><div class="line">	uint size;</div><div class="line">	uint offset;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>åˆšå¥½æ˜¯ 12 byte, æ‰€ä»¥ <strong>HackPoint</strong> å†™å…¥ dex æ–‡ä»¶çš„æ ¼å¼ä¸º:</p>
<p><img src="/blog_images/20170206/hp.png" alt="hp"></p>
<h2 id="0x05-é…ç½®æ–‡ä»¶"><a href="#0x05-é…ç½®æ–‡ä»¶" class="headerlink" title="0x05 é…ç½®æ–‡ä»¶"></a>0x05 é…ç½®æ–‡ä»¶</h2><p>é…ç½®æ–‡ä»¶çš„å®šä¹‰æ¯”è¾ƒç®€å•çœ‹ä¸€ä¸‹ç¤ºä¾‹å°±çŸ¥é“äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">####################################################</span></div><div class="line"><span class="comment">#    hack_class:      éšè—ç±»å®šä¹‰</span></div><div class="line"><span class="comment">#    hack_sf_val:     éšè—é™æ€å˜é‡</span></div><div class="line"><span class="comment">#    hack_me_size:    éšè—methods</span></div><div class="line"><span class="comment">#    hack_me_def:     é‡å¤å‡½æ•°å®šä¹‰ï¼ˆä»¥ç¬¬ä¸€ä¸ªä¸ºå‡†ï¼‰</span></div><div class="line"><span class="comment">#####################################################</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">#éšè—é™æ€å˜é‡å€¼</span></div><div class="line">hack_sf_val: cc.gnaixx.samp.core.EntranceImpl</div><div class="line"></div><div class="line"><span class="comment">#é‡å¤å‡½æ•°å®šä¹‰ï¼ˆä»¥ç¬¬ä¸€ä¸ªä¸ºå‡†ï¼‰</span></div><div class="line">hack_me_def: cc.gnaixx.samp.core.EntranceImpl</div><div class="line"></div><div class="line"><span class="comment">#éšè—å‡½æ•°å®ç°</span></div><div class="line">hack_me_size: cc.gnaixx.samp.core.EntranceImpl</div><div class="line"></div><div class="line"><span class="comment">#éšè—æ•´ä¸ªç±»å®ç°</span></div><div class="line">hack_class: cc.gnaixx.samp.core.EntranceImpl cc.gnaixx.samp.BuildConfig</div></pre></td></tr></table></figure>
<p><em>å½“å¤šä¸ªç±»éœ€è¦å®ç°åŒä¸€ä¸ªåŠŸèƒ½çš„æ—¶å€™åªéœ€è¦ç”¨ç©ºæ ¼åˆ†éš”å°±å¯ä»¥äº†</em></p>
<p>é…ç½®æ–‡ä»¶è¯»å–ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; readConfig(String path) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        Map&lt;String, List&lt;String&gt;&gt; config = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">        FileReader fr = <span class="keyword">new</span> FileReader(path);</div><div class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(fr);</div><div class="line">        String line;</div><div class="line">        <span class="keyword">while</span> ((line = br.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (!line.startsWith(<span class="string">"#"</span>) &amp;&amp; !line.equals(<span class="string">""</span>)) &#123;</div><div class="line">                String conf[] = line.split(<span class="string">":"</span>);</div><div class="line">                <span class="keyword">if</span> (conf.length != <span class="number">2</span>) &#123;</div><div class="line">                    log(<span class="string">"warning"</span>, <span class="string">"error config at :"</span> + line);</div><div class="line">                    System.exit(<span class="number">0</span>);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                String key = conf[<span class="number">0</span>];</div><div class="line">                String values[] = conf[<span class="number">1</span>].split(<span class="string">" "</span>);</div><div class="line">                List&lt;String&gt; valueList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</div><div class="line">                    <span class="keyword">if</span> (values[i] != <span class="keyword">null</span> &amp;&amp; !values[i].equals(<span class="string">""</span>)) &#123;</div><div class="line">                        valueList.add(values[i]);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                config.put(key, valueList);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        fr.close();</div><div class="line">        br.close();</div><div class="line">        <span class="keyword">return</span> config;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="0x06-dexæ··æ·†éšè—"><a href="#0x06-dexæ··æ·†éšè—" class="headerlink" title="0x06 dexæ··æ·†éšè—"></a>0x06 dexæ··æ·†éšè—</h2><p>dex æ–‡ä»¶æ··æ·†éšè—ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä¿®æ”¹ <strong>HackPoint</strong> å¹¶ä¿å­˜åˆ° dex æ–‡ä»¶æœ«å°¾</li>
<li>ä¿®å¤Header</li>
</ol>
<h3 id="1-ä¿®æ”¹-HackPoint"><a href="#1-ä¿®æ”¹-HackPoint" class="headerlink" title="1.ä¿®æ”¹ HackPoint"></a>1.ä¿®æ”¹ HackPoint</h3><p>é€šè¿‡å–å¾—çš„é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ç±»éå† <strong>class_def_item</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//æŸ¥æ‰¾é…ç½®æ–‡ä»¶æ‰€åœ¨ç±»ä½ç½®</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">seekHP</span><span class="params">(ClassDefs.ClassDef[] classDefItem, List&lt;String&gt; conf, String type, SeekCallBack callBack)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (conf == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; conf.size(); i++) &#123;</div><div class="line">        String classname = conf.get(i);</div><div class="line">        <span class="keyword">boolean</span> isDef = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; classDefItem.length; j++) &#123;</div><div class="line">            String className = dexFile.typeIds.getString(dexFile, classDefItem[j].classIdx); <span class="comment">//æŸ¥æ‰¾é¡ºåº class_idx =&gt; type_ids =&gt; string_ids</span></div><div class="line">            className = pathToPackages(className); <span class="comment">//è·å–ç±»å</span></div><div class="line">            <span class="keyword">if</span> (className.equals(classname)) &#123;</div><div class="line">                callBack.doHack(classDefItem[j], <span class="keyword">this</span>.hackPoints); <span class="comment">//å…·ä½“æ“ä½œ</span></div><div class="line">                log(type, conf.get(i));</div><div class="line">                isDef = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (isDef == <span class="keyword">false</span>) &#123;</div><div class="line">            log(<span class="string">"warning"</span>, <span class="string">"con't find class:"</span> + classname);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//å…·ä½“æ“ä½œå›è°ƒå¤„ç†</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SeekCallBack</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doHack</span><span class="params">(ClassDefs.ClassDef classDefItem, List&lt;HackPoint&gt; hackPoints)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>éšè—é™æ€å˜é‡å€¼:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éšè—é™æ€å˜é‡åˆå§‹åŒ–</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hackSfVal</span><span class="params">(ClassDefs.ClassDef[] classDefItem, List&lt;String&gt; conf)</span> </span>&#123;</div><div class="line">    seekHP(classDefItem, conf, Constants.HACK_SF_VAL, <span class="keyword">new</span> SeekCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doHack</span><span class="params">(ClassDefs.ClassDef classDefItem, List&lt;HackPoint&gt; hackPoints)</span> </span>&#123;</div><div class="line">            HackPoint point = classDefItem.staticValueOff.clone();  <span class="comment">//è·å–é™æ€å˜é‡æ•°æ®åç§»</span></div><div class="line">            hackPoints.add(point);                          <span class="comment">//æ·»åŠ ä¿®æ”¹ç‚¹</span></div><div class="line">            classDefItem.staticValueOff.value = <span class="number">0</span>;          <span class="comment">//å°†é™æ€å˜é‡çš„åç§»æ”¹ä¸º0ï¼ˆéšè—èµ‹å€¼ï¼‰</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>å‡½æ•°é‡å¤å®šä¹‰:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//é‡å¤å‡½æ•°å®šä¹‰</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hackMeDef</span><span class="params">(ClassDefs.ClassDef[] classDefItem, List&lt;String&gt; conf)</span></span>&#123;</div><div class="line">    seekHP(classDefItem, conf, Constants.HACK_ME_DEF, <span class="keyword">new</span> SeekCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doHack</span><span class="params">(ClassDefs.ClassDef classDefItem, List&lt;HackPoint&gt; hackPoints)</span> </span>&#123;</div><div class="line">            <span class="comment">//ä»¥ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤å€¼</span></div><div class="line">            <span class="keyword">int</span> virtualMeSize = classDefItem.classData.virtualMethodsSize.value;</div><div class="line">            <span class="keyword">int</span> virtualMeCodeOff = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; virtualMeSize; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</div><div class="line">                    virtualMeCodeOff = classDefItem.classData.virtualMethods[i].codeOff.value;</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    HackPoint point = classDefItem.classData.virtualMethods[i].codeOff.clone();</div><div class="line">                    hackPoints.add(point);</div><div class="line">                    classDefItem.classData.virtualMethods[i].codeOff.value = virtualMeCodeOff;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>å‡½æ•°éšè—ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éšè—å‡½æ•°å®šä¹‰</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hackMeSize</span><span class="params">(ClassDefs.ClassDef[] classDefItem, List&lt;String&gt; conf)</span></span>&#123;</div><div class="line">    seekHP(classDefItem, conf, Constants.HACK_ME_SIZE, <span class="keyword">new</span> SeekCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doHack</span><span class="params">(ClassDefs.ClassDef classDefItem, List&lt;HackPoint&gt; hackPoints)</span> </span>&#123;</div><div class="line">            HackPoint directPoint = classDefItem.classData.directMethodsSize.clone(); <span class="comment">//åŒæ—¶éœ€æ”¹è™šå‡½æ•°å’Œç›´æ¥å‡½æ•°</span></div><div class="line">            HackPoint virtualPoint = classDefItem.classData.virtualMethodsSize.clone();</div><div class="line">            hackPoints.add(directPoint);</div><div class="line">            hackPoints.add(virtualPoint);</div><div class="line">            classDefItem.classData.directMethodsSize.value = <span class="number">0</span>;</div><div class="line">            classDefItem.classData.virtualMethodsSize.value = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>éšè—ç±»ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//éšè—é™æ€å˜é‡åˆå§‹åŒ–</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hackSfVal</span><span class="params">(ClassDefs.ClassDef[] classDefItem, List&lt;String&gt; conf)</span> </span>&#123;</div><div class="line">    seekHP(classDefItem, conf, Constants.HACK_SF_VAL, <span class="keyword">new</span> SeekCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doHack</span><span class="params">(ClassDefs.ClassDef classDefItem, List&lt;HackPoint&gt; hackPoints)</span> </span>&#123;</div><div class="line">            HackPoint point = classDefItem.staticValueOff.clone();  <span class="comment">//è·å–é™æ€å˜é‡æ•°æ®åç§»</span></div><div class="line">            hackPoints.add(point);                          <span class="comment">//æ·»åŠ ä¿®æ”¹ç‚¹</span></div><div class="line">            classDefItem.staticValueOff.value = <span class="number">0</span>;          <span class="comment">//å°†é™æ€å˜é‡çš„åç§»æ”¹ä¸º0ï¼ˆéšè—èµ‹å€¼ï¼‰</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>æ·»åŠ  HackPoint æ•°æ®åˆ° dex æ–‡ä»¶ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//ä¿ç•™ä¿®æ”¹ä¿¡æ¯</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">appendHP</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">byte</span>[] pointsBuff = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hackPoints.size(); i++) &#123;</div><div class="line">        <span class="keyword">byte</span>[] pointBuff = hackpToBin(hackPoints.get(i));</div><div class="line">        pointsBuff = BufferUtil.append(pointsBuff, pointBuff, pointBuff.length);</div><div class="line">    &#125;</div><div class="line">    dexBuff = BufferUtil.append(dexBuff, pointsBuff, pointsBuff.length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//hackPoint è½¬ äºŒè¿›åˆ¶</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] hackpToBin(HackPoint point) &#123;</div><div class="line">    ByteBuffer bb = ByteBuffer.allocate(<span class="number">4</span> * <span class="number">3</span>);</div><div class="line">    bb.put(intToBin_Lit(point.type));</div><div class="line">    bb.put(intToBin_Lit(point.offset));</div><div class="line">    bb.put(intToBin_Lit(point.value));</div><div class="line">    <span class="keyword">return</span> bb.array();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//å°ç«¯äºŒè¿›åˆ¶</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] intToBin_Lit(<span class="keyword">int</span> integer)&#123;</div><div class="line">    <span class="keyword">byte</span>[] bin = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;</div><div class="line">            (<span class="keyword">byte</span>) ((integer &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>),</div><div class="line">            (<span class="keyword">byte</span>) ((integer &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>),</div><div class="line">            (<span class="keyword">byte</span>) ((integer &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>),</div><div class="line">            (<span class="keyword">byte</span>) ((integer &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>)</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">return</span> bin;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><em>dex æ–‡ä»¶éƒ½æ˜¯ä»¥å°ç«¯æ•°æ®ä¿å­˜</em></p>
<h3 id="2-ä¿®å¤Header"><a href="#2-ä¿®å¤Header" class="headerlink" title="2.ä¿®å¤Header"></a>2.ä¿®å¤Header</h3><p><strong>Header</strong> ä¸­ä¿®å¤çš„æ•°æ®æœ‰ä¸‰ä¸ªï¼š</p>
<ol>
<li>æ–‡ä»¶é•¿åº¦ </li>
<li>checksum</li>
<li>signature</li>
</ol>
<p><strong>ä¿®æ”¹ä»£ç :</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä¿®æ”¹header</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hackHeader</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//ä¿®æ”¹æ–‡ä»¶é•¿åº¦</span></div><div class="line">    Header header = dexFile.header;</div><div class="line">    header.fileSize = <span class="keyword">this</span>.dexBuff.length;</div><div class="line">    header.write(dexBuff); <span class="comment">//éœ€è¦å…ˆä¿®æ”¹æ–‡ä»¶é•¿åº¦ï¼Œæ‰èƒ½è®¡ç®—signature checksum</span></div><div class="line">    <span class="comment">//ä¿®å¤ signature æ ¡éªŒ</span></div><div class="line">    log(<span class="string">"old_signature"</span>, binToHex(dexFile.header.signature));</div><div class="line">    <span class="keyword">byte</span>[] signature = signature(dexBuff, SIGNATURE_LEN + SIGNATURE_OFF);</div><div class="line">    header.signature = signature;</div><div class="line">    log(<span class="string">"new_signature"</span>, binToHex(signature));</div><div class="line">    header.write(dexBuff); <span class="comment">//éœ€è¦å…ˆå†™sinature,æ‰èƒ½è®¡ç®—checksumï¼Œå‡¸</span></div><div class="line">    <span class="comment">//ä¿®å¤ checksum æ ¡éªŒ</span></div><div class="line">    log(<span class="string">"old_checksum"</span>, intToHex(dexFile.header.checksum));</div><div class="line">    <span class="keyword">int</span> checksum = checksum_Lit(dexBuff, CHECKSUM_LEN + CHECKSUM_OFF);</div><div class="line">    header.checksum = checksum;</div><div class="line">    log(<span class="string">"new_checksum"</span>, intToHex(checksum));</div><div class="line">    header.write(dexBuff);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//è®¡ç®—signature</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] signature(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> off) &#123;</div><div class="line">    <span class="keyword">int</span> len = data.length - off;</div><div class="line">    <span class="keyword">byte</span>[] signature = SHA1(data, off, len);</div><div class="line">    <span class="keyword">return</span> signature;</div><div class="line">&#125;</div><div class="line"><span class="comment">//sha1ç®—æ³•</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] SHA1(<span class="keyword">byte</span>[] decript, <span class="keyword">int</span> off, <span class="keyword">int</span> len) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        MessageDigest digest = MessageDigest.getInstance(<span class="string">"SHA-1"</span>);</div><div class="line">        digest.update(decript, off, len);</div><div class="line">        <span class="keyword">byte</span> messageDigest[] = digest.digest();</div><div class="line">        <span class="keyword">return</span> messageDigest;</div><div class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//è®¡ç®—checksum å€¼</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">checksum_Lit</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> off)</span> </span>&#123;</div><div class="line">    <span class="keyword">byte</span>[] bin = checksum_bin(data, off);</div><div class="line">    <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; UINT_LEN; i++) &#123;</div><div class="line">        <span class="keyword">int</span> seg = bin[i];</div><div class="line">        <span class="keyword">if</span> (seg &lt; <span class="number">0</span>) &#123;</div><div class="line">            seg = <span class="number">256</span> + seg;</div><div class="line">        &#125;</div><div class="line">        value += seg &lt;&lt; (<span class="number">8</span> * i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> value;</div><div class="line">&#125;</div><div class="line"><span class="comment">//è®¡ç®—checksum</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] checksum_bin(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> off) &#123;</div><div class="line">    <span class="keyword">int</span> len = data.length - off;</div><div class="line">    Adler32 adler32 = <span class="keyword">new</span> Adler32();</div><div class="line">    adler32.reset();</div><div class="line">    adler32.update(data, off, len);</div><div class="line">    <span class="keyword">long</span> checksum = adler32.getValue();</div><div class="line">    <span class="keyword">byte</span>[] checksumbs = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;</div><div class="line">            (<span class="keyword">byte</span>) checksum,</div><div class="line">            (<span class="keyword">byte</span>) (checksum &gt;&gt; <span class="number">8</span>),</div><div class="line">            (<span class="keyword">byte</span>) (checksum &gt;&gt; <span class="number">16</span>),</div><div class="line">            (<span class="keyword">byte</span>) (checksum &gt;&gt; <span class="number">24</span>)&#125;;</div><div class="line">    <span class="keyword">return</span> checksumbs;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¯¥éƒ¨åˆ†ä»£ç åœ°å€: <strong><a href="https://github.com/gnaixx/hidex-hack/blob/master/hidex-tool/src/main/java/cc/gnaixx/tools/core/HidexHandle.java" target="_blank" rel="external">HidexHandle.java</a></strong></p>
<h2 id="0x07-dexè¿˜åŸ"><a href="#0x07-dexè¿˜åŸ" class="headerlink" title="0x07 dexè¿˜åŸ"></a>0x07 dexè¿˜åŸ</h2><p>ç›¸å¯¹äºåŠ å¯†è§£å¯†è¿‡ç¨‹ç®€å•äº†å¾ˆå¤šï¼Œåªè¦æ ¹æ® <strong>HackPoint</strong> æ•°æ®ä¸€ä¸€ä¿®å¤å°±å¥½äº†ã€‚è¿™é‡Œç®€å•çš„è¯´ä¸‹ä¿®å¤æ­¥éª¤ï¼š</p>
<ol>
<li>è¯»å– Header ä¸­ <strong>map_list</strong> çš„åç§»åœ°å€å’Œä¸ªæ•°ï¼Œå› ä¸º <strong>HackPoint</strong> æ•°æ®ä¿å­˜åœ¨ <strong>map_list</strong> ä¹‹å</li>
<li>è¯»å– <strong>HackPoint</strong> æ•°æ®å¹¶ä¿®å¤ dex æ–‡ä»¶</li>
<li>ä¿®å¤ Header ä¸­çš„ <strong>file_sizeã€checksumã€signature</strong></li>
</ol>
<h3 id="java-å®ç°"><a href="#java-å®ç°" class="headerlink" title="java å®ç°"></a>java å®ç°</h3><p>ä¿®å¤å…³é”®æºç ï¼š    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä¿®å¤dexæ–‡ä»¶</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] redex() &#123;</div><div class="line">    <span class="keyword">int</span> mapOff = getUint(dexBuff, MAP_OFF_OFF); <span class="comment">//è·å–map_off</span></div><div class="line">    <span class="keyword">int</span> mapSize = getUint(dexBuff, mapOff); <span class="comment">//è·å–map_size</span></div><div class="line">    <span class="keyword">int</span> hackInfoStart = mapOff + UINT_LEN + (mapSize * MAP_ITEM_LEN); <span class="comment">//è·å– hackinfo å¼€å§‹åœ°å€</span></div><div class="line">    <span class="keyword">int</span> hackInfoLen = dexBuff.length - hackInfoStart; <span class="comment">//è·å–hackinfo é•¿åº¦</span></div><div class="line">    hackInfoBuff = subdex(dexBuff, hackInfoStart, hackInfoLen); <span class="comment">//è·å–hackæ•°æ®</span></div><div class="line">    <span class="keyword">int</span> dexLen = dexBuff.length - hackInfoLen;</div><div class="line">    dexBuff = subdex(dexBuff, <span class="number">0</span>, dexLen); <span class="comment">//æˆªå–åŸå§‹dexé•¿åº¦</span></div><div class="line">    HackPoint[] hackPoints = Trans.binToHackP(hackInfoBuff);  <span class="comment">//ä¿®å¤hackç‚¹</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hackPoints.length; i++) &#123;</div><div class="line">        log(<span class="string">"hackPoint"</span>, JSON.toJSONString(hackPoints[i]));</div><div class="line">        recovery(hackPoints[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">byte</span>[] fileSize = intToBin_Lit(dexLen); <span class="comment">//ä¿®å¤æ–‡ä»¶é•¿åº¦</span></div><div class="line">    replace(dexBuff, fileSize, FILE_SIZE_OFF, UINT_LEN);</div><div class="line">    <span class="keyword">byte</span>[] signature = signature(dexBuff, SIGNATURE_LEN + SIGNATURE_OFF); <span class="comment">//ä¿®å¤signatureæ ¡éªŒ</span></div><div class="line">    replace(dexBuff, signature, SIGNATURE_OFF, SIGNATURE_LEN);</div><div class="line">    <span class="keyword">byte</span>[] checksum = checksum_bin(dexBuff, CHECKSUM_LEN + CHECKSUM_OFF); <span class="comment">//ä¿®å¤checksumæ ¡éªŒ</span></div><div class="line">    replace(dexBuff, checksum, CHECKSUM_OFF, CHECKSUM_LEN);</div><div class="line">    log(<span class="string">"fileSize"</span>, dexLen);</div><div class="line">    log(<span class="string">"signature"</span>, binToHex(signature));</div><div class="line">    log(<span class="string">"checksum"</span>, binToHex_Lit(checksum));</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.dexBuff;</div><div class="line">&#125;</div><div class="line"><span class="comment">//è¿˜åŸåŸå§‹å€¼</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recovery</span><span class="params">(HackPoint hackPoint)</span> </span>&#123;</div><div class="line">    Writer writer = <span class="keyword">new</span> Writer(<span class="keyword">this</span>.dexBuff, hackPoint.offset);</div><div class="line">    <span class="keyword">if</span> (hackPoint.type == HackPoint.USHORT) &#123;</div><div class="line">        writer.writeUshort(hackPoint.value);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (hackPoint.type == HackPoint.UINT) &#123;</div><div class="line">        writer.writeUint(hackPoint.value);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (hackPoint.type == HackPoint.ULEB128) &#123;</div><div class="line">        Uleb128 uleb128 = Trans.intToUleb128(hackPoint.value);</div><div class="line">        writer.writeUleb128(uleb128);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="c-å®ç°"><a href="#c-å®ç°" class="headerlink" title="c++ å®ç°"></a>c++ å®ç°</h3><p>å·¥å…·æœ¬èº«å°±æ˜¯ä¸ºäº†å®ç°å®‰å…¨åŠ å›ºï¼Œé‚£ä¹ˆç”¨ java å®ç°æ„ä¹‰å°±å°äº†å¾ˆå¤šï¼Œæ‰€ä»¥å·¥å…·åŒ…é‡Œé¢çš„å®ç°æˆ‘æ˜¯ç”¨ NDK å¼€å‘çš„ã€‚</p>
<p>ä¿®å¤å…³é”®æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//è§£å¯†dex</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">recode</span><span class="params">(<span class="keyword">char</span>* source, uint sourceLen, <span class="keyword">char</span>* target, uint* targetLen)</span></span>&#123;</div><div class="line">    uint mapOff = readUint(source, MAP_OFF_OFF); <span class="comment">//è·å–map_off</span></div><div class="line">    uint mapSize = readUint(source, mapOff); <span class="comment">//è·å–map_size</span></div><div class="line">    LOGD(<span class="string">"mapInfo: &#123;map_off:%d, map_size:%d&#125;"</span>, mapOff, mapSize);</div><div class="line"></div><div class="line">    uint hackInfoOff = mapOff + UINT_LEN + (mapSize * MAP_ITEM_LEN); <span class="comment">//å®šä½hackInfoä½ç½®</span></div><div class="line">    uint hackInfoLen = sourceLen - hackInfoOff; <span class="comment">//hackInfoé•¿åº¦</span></div><div class="line">    <span class="keyword">char</span>* hackInfo = (<span class="keyword">char</span> *) calloc(hackInfoLen, sizeof(<span class="keyword">char</span>));</div><div class="line">    memcpy(hackInfo, source + hackInfoOff, hackInfoLen); <span class="comment">//å¤åˆ¶hackInfo</span></div><div class="line">    LOGD(<span class="string">"hackInfo: &#123;hackInfo_off:%d, hackInfo_len&#125;"</span>, hackInfoOff, hackInfoLen);</div><div class="line"></div><div class="line">    uint hackPointSize = hackInfoLen / sizeof(HackPoint); <span class="comment">//è·å–hackPointç»“æ„ä½“</span></div><div class="line">    HackPoint* hackPoints = (HackPoint *) calloc(hackPointSize, sizeof(HackPoint));</div><div class="line">    initHP(hackPoints, hackInfo, hackPointSize); <span class="comment">//å°†hockInfo è½¬åŒ–ä¸ºç»“æ„ä½“</span></div><div class="line"></div><div class="line">    *targetLen = hackInfoOff;</div><div class="line">    memcpy(target, source, *targetLen); <span class="comment">//æ¢å¤åŸå§‹é•¿åº¦</span></div><div class="line"></div><div class="line">    <span class="comment">//æ¢å¤æ•°æ®</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;hackPointSize; i++)&#123;</div><div class="line">        recoverHP(target, hackPoints[i]);</div><div class="line">    &#125;</div><div class="line">    LOGD(<span class="string">"Recover HackPoint success"</span>);</div><div class="line"></div><div class="line">    <span class="comment">//ä¿®å¤hearder</span></div><div class="line">    recoverHeader(target, *targetLen);</div><div class="line"></div><div class="line">    free(hackInfo);</div><div class="line">    free(hackPoints);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å®Œæ•´æºç åœ°å€: <strong><a href="https://github.com/gnaixx/hidex-hack/blob/master/hidex-libs/src/main/cpp/hidex.cpp" target="_blank" rel="external">hidex.cpp</a></strong></p>
<h2 id="0x09-æ€»ç»“"><a href="#0x09-æ€»ç»“" class="headerlink" title="0x09 æ€»ç»“"></a>0x09 æ€»ç»“</h2><p>æ•´ä½“åŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå®ç°çš„ä»£ç ä¹Ÿä¸æ˜¯å¾ˆå¤æ‚ï¼Œä½†æ˜¯è¿™äº›éƒ½éœ€è¦åŸºäºå¯¹ dex æ–‡ä»¶æ ¼å¼çš„äº†è§£çš„å‰æä¸‹ã€‚<br>å¦å¤–è¯¥å·¥å…·å­˜åœ¨ä¸€ä¸ªç¼ºç‚¹ï¼Œdex çš„åŠ è½½é—®é¢˜ã€‚Androidä¸­åŠ è½½ dex çš„ DexClassLoad åªæ”¯æŒæ–‡ä»¶è·¯å¾„åŠ è½½ï¼Œä¸åƒ java ä¸­çš„ ClassLoad å¯ä»¥æ”¯æŒäºŒè¿›åˆ¶æµåŠ è½½ï¼Œæ‰€ä»¥åœ¨åŠ è½½ dex æ˜¯å°±å­˜åœ¨åŠ å¯†åçš„ dex ç¼“å­˜ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚æ‰€ä»¥ä¸‹ä¸ªç ”ç©¶çš„ç‚¹ä¹Ÿå°±æ˜¯è‡ªå®šä¹‰ DexClassLoad å®ç°ä¸è½åœ°åŠ è½½ã€‚ï¼ˆå¾ˆå¤šå®‰å…¨åŠ å›ºå‚å•†è€æ—©å°±å®ç°äº†ğŸ™„ï¼‰ã€‚<br>è™½ç„¶åŠŸèƒ½ä¸ç®—å¼ºå¤§ï¼Œä¹Ÿæœ‰ä¸å°‘ç¼ºç‚¹ï¼Œä¸è¿‡ä¹ŸèŠ±äº†è‡ªå·±ä¸å°‘æ—¶é—´ç ”ç©¶ï¼Œå¯¹ dex æ–‡ä»¶æ ¼å¼ä¹Ÿæœ‰ç‚¹äº†è§£ï¼Œä¹Ÿç®—å€¼å¾—äº†ã€‚</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>èµä¸€ä¸ªå‘—ï¼</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechatpay.png" alt="å‡¸ä¸€_ä¸€å‡¸ WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay.jpg" alt="å‡¸ä¸€_ä¸€å‡¸ Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/android/" rel="tag">#android</a>
          
            <a href="/tags/dex/" rel="tag">#dex</a>
          
            <a href="/tags/hidex/" rel="tag">#hidex</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/26/20161126dex-file/" rel="next" title="DEXæ–‡ä»¶æ ¼å¼åˆ†æ">
                <i class="fa fa-chevron-left"></i> DEXæ–‡ä»¶æ ¼å¼åˆ†æ
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/02/06/20170206hidex-hack/"
           data-title="DEXæ–‡ä»¶æ··æ·†åŠ å¯†" data-url="http://gnaixx.github.io/2017/02/06/20170206hidex-hack/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/custom_avatar.jpg"
               alt="å‡¸ä¸€_ä¸€å‡¸" />
          <p class="site-author-name" itemprop="name">å‡¸ä¸€_ä¸€å‡¸</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/gnaixx" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              å‹æƒ…é“¾æ¥
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://waynecz.github.io/" title="wayne" target="_blank">wayne</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">0x00 å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-dexæ ¼å¼åˆ†æ"><span class="nav-number">2.</span> <span class="nav-text">0x01 dexæ ¼å¼åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-å®ç°åŠŸèƒ½"><span class="nav-number">3.</span> <span class="nav-text">0x02 å®ç°åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-é™æ€å˜é‡éšè—"><span class="nav-number">3.1.</span> <span class="nav-text">1.é™æ€å˜é‡éšè—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-å‡½æ•°é‡å¤å®šä¹‰"><span class="nav-number">3.2.</span> <span class="nav-text">2.å‡½æ•°é‡å¤å®šä¹‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-å‡½æ•°éšè—"><span class="nav-number">3.3.</span> <span class="nav-text">3.å‡½æ•°éšè—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-ç±»å®šä¹‰éšè—"><span class="nav-number">3.4.</span> <span class="nav-text">4.ç±»å®šä¹‰éšè—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-æ•°æ®è¯»å–"><span class="nav-number">4.</span> <span class="nav-text">0x03 æ•°æ®è¯»å–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-HackPointæ ¼å¼"><span class="nav-number">5.</span> <span class="nav-text">0x04 HackPointæ ¼å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-é…ç½®æ–‡ä»¶"><span class="nav-number">6.</span> <span class="nav-text">0x05 é…ç½®æ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-dexæ··æ·†éšè—"><span class="nav-number">7.</span> <span class="nav-text">0x06 dexæ··æ·†éšè—</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ä¿®æ”¹-HackPoint"><span class="nav-number">7.1.</span> <span class="nav-text">1.ä¿®æ”¹ HackPoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ä¿®å¤Header"><span class="nav-number">7.2.</span> <span class="nav-text">2.ä¿®å¤Header</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x07-dexè¿˜åŸ"><span class="nav-number">8.</span> <span class="nav-text">0x07 dexè¿˜åŸ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java-å®ç°"><span class="nav-number">8.1.</span> <span class="nav-text">java å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c-å®ç°"><span class="nav-number">8.2.</span> <span class="nav-text">c++ å®ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x09-æ€»ç»“"><span class="nav-number">9.</span> <span class="nav-text">0x09 æ€»ç»“</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å‡¸ä¸€_ä¸€å‡¸</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"gnaix"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

  


</body>
</html>

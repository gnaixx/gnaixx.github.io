
<html>
    <script></script>
    <header>
        <title>gnaixx.cc</title>
    </header>
    <body style="text-align: center;">
        <div id="content" style="width: 100%; height: 30%; font-size:50px; text-align: center;"></div>
        <button id="auth" onclick="onAuth()" style="width: 400px; height: 100px; font-size: 50px;">获取Code</button>
        <br/><br/>
        <button id="auth" onclick="onBack()" style="width: 400px; height: 100px; font-size: 50px;">授权回退</button>

        <script src="https://g.alicdn.com/dingding/dingtalk-jsapi/2.13.42/dingtalk.open.js"></script>
        <script type="text/javascript">
            function myfun(){
                corpId = getQueryVariable("corpId");
                // alert("CorpId:" + corpId);
                var div = document.getElementById("content");
                div.innerHTML = "corpId:\n" + corpId;
            }
            window.onload = myfun;

            function onAuth() {
                dd.runtime.permission.requestAuthCode({
                    corpId: 'ding191d0eb30a8aadf2ee0f45d8e4f7c288',
                    onSuccess: function(result) {
                        alert('AuthCode: ' + result.code);
                    },
                    onFail: function(err) {
                        alert('requestAuthCode fail: ' + JSON.stringify(err));
                    }
                });
            }
            function onBack() {
                dd.runtime.permission.requestAuthCode({
                    corpId: 'ding191d0eb30a8aadf2ee0f45d8e4f7c288',
                    onSuccess: function(result) {
                        // alert('AuthCode: ' + result.code);
                        window.location.href = "xunxiu://xunxiu?code=" + result.code;
                    },
                    onFail: function(err) {
                        alert('requestAuthCode fail: ' + JSON.stringify(err));
                    }
                });
            }

            function getQueryVariable(variable){
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                        var pair = vars[i].split("=");
                        if(pair[0] == variable){return pair[1];}
                }
                return("");
            }


            // dd.ready(function() {
            //     // dd.ready参数为回调函数，在环境准备就绪时触发，jsapi的调用需要保证在该回调函数触发后调用，否则无效。
            //     dd.runtime.permission.requestAuthCode({
            //         corpId: "ding191d0eb30a8aadf2ee0f45d8e4f7c288",
            //         onSuccess: function(result) {
            //             alert(JSON.stringify(result));
            //             console.log(result);
            //         },
            //         onFail : function(err) {
            //             alert(JSON.stringify(err));
            //             console.log(err);
            //         }
            //     });
            // });
        </script>
    </body>
</html>